; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html

[env:bootloader]
platform = ststm32
board = genericSTM32G431CB
framework = stm32cube
upload_protocol = stlink

; --- Bootloader-specific build settings ---
build_flags =
    -DSTM32G4xx             ; Tell HAL which family
    -DSTM32G431xx           ; Tell HAL which chip
    -DBOOTLOADER            ; Optional tag for conditional compilation
    -DUSE_FULL_LL_DRIVER    ; Good for bootloaders (LL is tiny)
    -Os                     ; Optimize for size (important!)
    -ffunction-sections
    -fdata-sections
    -Wl,--gc-sections

; --- Bootloader memory layout ---
board_upload.offset_address = 0x08000000
board_upload.maximum_size = 16384     ; 16 KB bootloader (adjust as needed)

; --- Debug and upload tools ---
debug_tool = stlink
